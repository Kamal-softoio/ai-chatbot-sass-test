<?php

namespace App\Services;

use Illuminate\Support\Facades\Log;

class MockOllamaService extends OllamaService
{
    /**
     * Ù…Ø­Ø§ÙƒÙŠ Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
     */
    public function generateResponse(string $model, array $data, array $options = []): array
    {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
        sleep(rand(1, 3));

        Log::info('Mock Ollama Response', [
            'model' => $model,
            'messages' => $data['messages'] ?? [],
            'options' => $options,
        ]);

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        $messages = $data['messages'] ?? [];
        $lastMessage = end($messages);
        $userInput = $lastMessage['content'] ?? 'Ù…Ø±Ø­Ø¨Ø§';

        // Ø±Ø¯ÙˆØ¯ Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        $responses = $this->generateSmartResponse($userInput);
        $selectedResponse = $responses[array_rand($responses)];

        return [
            'model' => $model,
            'created_at' => now()->toISOString(),
            'message' => [
                'role' => 'assistant',
                'content' => $selectedResponse,
            ],
            'done' => true,
            'total_duration' => rand(1000000000, 3000000000), // nanoseconds
            'load_duration' => rand(100000000, 500000000),
            'prompt_eval_count' => rand(20, 50),
            'prompt_eval_duration' => rand(500000000, 1000000000),
            'eval_count' => rand(50, 200),
            'eval_duration' => rand(1000000000, 2000000000),
        ];
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ÙˆØ¯ Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
     */
    private function generateSmartResponse(string $input): array
    {
        $input = strtolower(trim($input));

        // Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªØ±Ø­ÙŠØ¨
        if (preg_match('/(Ø£Ù‡Ù„Ø§|Ù…Ø±Ø­Ø¨Ø§|Ù‡Ù„Ø§|Ø§Ù„Ø³Ù„Ø§Ù…|ØµØ¨Ø§Ø­|Ù…Ø³Ø§Ø¡)/', $input)) {
            return [
                'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ðŸ˜Š ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
                'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ. Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡ØŸ',
                'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡! ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø£Ù† Ø£ÙƒÙˆÙ† ÙÙŠ Ø®Ø¯Ù…ØªÙƒ',
                'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ! ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ ÙˆÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ù† Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ',
            ];
        }

        // Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
        if (preg_match('/(Ø®Ø¯Ù…Ø§|Ù…Ù†ØªØ¬|Ø³Ø¹Ø±|ØªÙƒÙ„ÙØ©|Ø´Ø±Ø§Ø¡)/', $input)) {
            return [
                'Ù†Ø­Ù† Ù†Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ§Ù„Ø´Ø§Øª Ø¨ÙˆØª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ø®Ø¯Ù…Ø© Ù…Ø¹ÙŠÙ†Ø©ØŸ',
                'Ù„Ø¯ÙŠÙ†Ø§ Ø¨Ø§Ù‚Ø§Øª Ù…Ø®ØªÙ„ÙØ© ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† Ø£ÙˆØ¶Ø­ Ù„Ùƒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ù…ÙŠØ²Ø§ØªØŸ',
                'Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ ØªØ´Ù…Ù„ Ø­Ù„ÙˆÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø´Ø±ÙƒØ§Øª. Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø°ÙŠ ØªÙ‚ÙˆÙ… Ø¨Ù‡ØŸ',
            ];
        }

        // Ø£Ø³Ø¦Ù„Ø© ØªÙ‚Ù†ÙŠØ©
        if (preg_match('/(ØªÙ‚Ù†ÙŠ|Ø¨Ø±Ù…Ø¬|ÙƒÙˆØ¯|ØªØ·ÙˆÙŠØ±|websocket|laravel)/', $input)) {
            return [
                'Ø£Ù†Ø§ Ù…Ø·ÙˆØ± Ø¨ØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø© Ù…Ø«Ù„ Laravel 12 Ùˆ WebSocket! Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©ØŸ',
                'Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª Ù…Ø·ÙˆØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Laravel Reverb Ù„Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ùˆ Ollama Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. Ø±Ø§Ø¦Ø¹ØŒ Ø£Ù„ÙŠØ³ ÙƒØ°Ù„ÙƒØŸ',
                'Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ù€ WebSocket ÙŠØ¹Ø·ÙŠ ØªØ¬Ø±Ø¨Ø© ÙÙˆØ±ÙŠØ© Ù…Ù…ØªØ§Ø²Ø©! Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù…Ø´Ø±ÙˆØ¹ ØªÙ‚Ù†ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠÙ‡ØŸ',
            ];
        }

        // Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        if (preg_match('/(Ù…Ø³Ø§Ø¹Ø¯|Ø³Ø§Ø¹Ø¯|ÙŠÙ…ÙƒÙ†Ùƒ|Ù‚Ø§Ø¯Ø±|ØªØ³ØªØ·ÙŠØ¹)/', $input)) {
            return [
                'ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø£Ù…ÙˆØ±! Ø£Ø¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ø£Ù‚Ø¯Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙˆØ£Ø³Ø§Ø¹Ø¯ ÙÙŠ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„. Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ØŸ',
                'Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©. Ø£Ø³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§ØªØŒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø®Ø¯Ù…ØªÙƒØŸ',
                'Ù„Ø¯ÙŠ Ù‚Ø¯Ø±Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† Ù†ØªØ­Ø¯Ø« Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø¹ÙŠÙ† Ø£Ù… Ù„Ø¯ÙŠÙƒ Ø³Ø¤Ø§Ù„ Ù…Ø­Ø¯Ø¯ØŸ',
            ];
        }

        // Ø£Ø³Ø¦Ù„Ø© Ø´Ø®ØµÙŠØ©
        if (preg_match('/(Ø£Ù†Øª|Ø§Ø³Ù…Ùƒ|Ù…Ù†|ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ)/', $input)) {
            return [
                'Ø£Ù†Ø§ Ø£Ù†ÙŠØ³ØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ! ðŸ¤– Ø£Ø¹Ù…Ù„ Ø¨ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡.',
                'Ø§Ø³Ù…ÙŠ Ø£Ù†ÙŠØ³ ÙˆØ£Ù†Ø§ Ø¨Ø®ÙŠØ±ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø³Ø¤Ø§Ù„Ùƒ! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø£ÙƒÙˆÙ† Ø±ÙÙŠÙ‚Ùƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©. ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø£Ù†ØªØŸ',
                'Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ØªÙ… ØªØ·ÙˆÙŠØ±ÙŠ Ø®ØµÙŠØµØ§Ù‹ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© Ù…Ø­Ø§Ø¯Ø«Ø©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ù† Ø£Ø¬Ø¹Ù„ ÙŠÙˆÙ…Ùƒ Ø£ÙØ¶Ù„ØŸ',
            ];
        }

        // Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ø§Ù„ÙˆÙ‚Øª Ø£Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ®
        if (preg_match('/(ÙˆÙ‚Øª|Ø³Ø§Ø¹Ø©|ØªØ§Ø±ÙŠØ®|ÙŠÙˆÙ…)/', $input)) {
            $currentTime = now()->format('Y-m-d H:i:s');
            $dayName = now()->locale('ar')->dayName;

            return [
                "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù† Ù‡Ùˆ {$currentTime} - ÙŠÙˆÙ… {$dayName}. Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ",
                "Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ {$dayName} ÙˆØ§Ù„ÙˆÙ‚Øª {$currentTime}. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",
                "Ù†Ø­Ù† ÙÙŠ ÙŠÙˆÙ… {$dayName} ÙˆØ§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¢Ù† ".now()->format('H:i').'. Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ÙØ¹Ù„Ù‡ Ù…Ù† Ø£Ø¬Ù„ÙƒØŸ',
            ];
        }

        // Ø±Ø¯ÙˆØ¯ Ø¹Ø§Ù…Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰
        return [
            'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„ØªÙƒ! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¶ÙŠØ­ Ø£ÙƒØ«Ø± Ø¹Ù† Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ØŸ',
            'Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ø¬ÙŠØ¯! Ø¯Ø¹Ù†ÙŠ Ø£ÙÙƒØ±... ðŸ¤” Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø·Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŸ',
            'Ø£Ù‚Ø¯Ø± ØªÙØ§Ø¹Ù„Ùƒ Ù…Ø¹ÙŠ! Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ Ø­Ø§ÙˆÙ„ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± ØªØ­Ø¯ÙŠØ¯Ø§Ù‹ ÙÙŠ Ø³Ø¤Ø§Ù„Ùƒ.',
            'Ø±Ø³Ø§Ù„Ø© Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…! Ø£Ù†Ø§ Ø£ØªØ¹Ù„Ù… Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù„Ø£Ù‚Ø¯Ù… Ù„Ùƒ Ø£ÙØ¶Ù„ Ø¥Ø¬Ø§Ø¨Ø©. Ù…Ø§ Ø±Ø£ÙŠÙƒ Ù„Ùˆ Ø£Ø¹Ø¯Øª ØµÙŠØ§ØºØ© Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ',
            'Ø£Ù†Ø§ Ø³Ø¹ÙŠØ¯ Ø¨Ø§Ù„Ø­Ø¯ÙŠØ« Ù…Ø¹Ùƒ! Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø³Ø¤Ø§Ù„ Ù…Ø­Ø¯Ø¯ Ø£Ùˆ ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø´ÙŠØ¡ Ù…Ø¹ÙŠÙ†ØŒ ÙÙ‚Ø· Ø£Ø®Ø¨Ø±Ù†ÙŠ.',
            'Ù…Ù…ØªØ§Ø²! Ø£Ø­Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª. Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ù…Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ØŸ',
        ];
    }

    /**
     * Ù…Ø­Ø§ÙƒÙŠ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„
     */
    public function isHealthy(): bool
    {
        return true; // Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…ØªØ§Ø­
    }

    /**
     * Ù…Ø­Ø§ÙƒÙŠ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
     */
    public function getAvailableModels(): array
    {
        return [
            [
                'name' => 'qwen2.5-coder:latest',
                'modified_at' => now()->toISOString(),
                'size' => 4661838465,
                'digest' => 'mock-digest-123',
                'details' => [
                    'format' => 'gguf',
                    'family' => 'qwen2',
                    'families' => ['qwen2'],
                    'parameter_size' => '7.6B',
                    'quantization_level' => 'Q4_K_M',
                ],
            ],
            [
                'name' => 'llama3.1:latest',
                'modified_at' => now()->subHours(2)->toISOString(),
                'size' => 5630000000,
                'digest' => 'mock-digest-456',
                'details' => [
                    'format' => 'gguf',
                    'family' => 'llama',
                    'parameter_size' => '8B',
                    'quantization_level' => 'Q4_K_M',
                ],
            ],
        ];
    }
}
